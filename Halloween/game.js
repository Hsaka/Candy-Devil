
﻿var Utils={};Utils.GlobalSettings={namespace:'candydevil',width:640,height:960,aspectX:1,aspectY:1,muted:false,lastNickname:'',firstTime:true,isMobile:false,continuing:false,adReady:false,text:null,timesAdNotShown:0,adJustShown:false,mode:0,itemsAvailable:[0,-1],itemSelected:0,coins:0,fromScreen:'',timesPlayed:0,getHexValue:function(color){var hexStr=Phaser.Color.RGBtoString(color.r,color.g,color.b,color.a,'#');return parseInt(hexStr.replace(/^#/,''),16);},save:function(){if(DataStorage.supportsLocalStorage()){localStorage[this.namespace+".muted"]=JSON.stringify(this.muted);localStorage[this.namespace+".firstTime"]=JSON.stringify(this.firstTime);localStorage[this.namespace+".lastNickname"]=JSON.stringify(this.lastNickname);localStorage[this.namespace+".coins"]=JSON.stringify(this.coins);localStorage[this.namespace+".itemSelected"]=JSON.stringify(this.itemSelected);localStorage[this.namespace+".itemsAvailable"]=JSON.stringify(this.itemsAvailable);localStorage[this.namespace+".timesPlayed"]=JSON.stringify(this.timesPlayed);}
else{DataStorage.GlobalSettings.database.save('save',JSON.stringify(this.muted)+'#'+
JSON.stringify(this.firstTime)+'#'+
JSON.stringify(this.lastNickname)+'#'+
JSON.stringify(this.coins)+'#'+
JSON.stringify(this.itemSelected)+'#'+
JSON.stringify(this.itemsAvailable)+'#'+
JSON.stringify(this.timesPlayed),null);}},load:function(){if(DataStorage.supportsLocalStorage()){if(localStorage[this.namespace+".muted"]){this.muted=JSON.parse(localStorage[this.namespace+".muted"]);}
if(localStorage[this.namespace+".firstTime"]){this.firstTime=JSON.parse(localStorage[this.namespace+".firstTime"]);}
if(localStorage[this.namespace+".lastNickname"]){this.lastNickname=JSON.parse(localStorage[this.namespace+".lastNickname"]);}
if(localStorage[this.namespace+".coins"]){this.coins=JSON.parse(localStorage[this.namespace+".coins"]);}
if(localStorage[this.namespace+".itemSelected"]){this.itemSelected=JSON.parse(localStorage[this.namespace+".itemSelected"]);}
if(localStorage[this.namespace+".itemsAvailable"]){var kites=JSON.parse(localStorage[this.namespace+".itemsAvailable"]);if(kites){for(var i=0;i<kites.length;i++){this.itemsAvailable[i]=kites[i];}}}
if(localStorage[this.namespace+".timesPlayed"]){this.timesPlayed=JSON.parse(localStorage[this.namespace+".timesPlayed"]);}}
else{var data=DataStorage.GlobalSettings.database.load('save');if(data&&data.length>0){var loadedData=data.split('#');if(loadedData&&loadedData.length===7){this.muted=JSON.parse(loadedData[0]);this.firstTime=JSON.parse(loadedData[1]);this.lastNickname=JSON.parse(loadedData[2]);this.coins=JSON.parse(loadedData[3]);this.itemSelected=JSON.parse(loadedData[4]);var kites=JSON.parse(loadedData[5]);if(kites){for(var i=0;i<kites.length;i++){this.itemsAvailable[i]=kites[i];}}
this.timesPlayed=JSON.parse(loadedData[6]);}}}}};Utils.BackgroundMusic={load:function(game){this.bgm1=game.add.audio('bgm');}};Utils.MersenneTwister=function(seed){'use strict';if(typeof seed==='undefined'){seed=new Date().getTime();}
this.MAX_INT=4294967296.0;this.N=624;this.M=397;this.UPPER_MARK=0x80000000;this.LOWER_MASK=0x7fffffff;this.MATRIX_A=0x9908b0df;this.mt=new Array(this.N);this.mti=this.N+1;this.seed(seed);};Utils.MersenneTwister.prototype={seed:function(seed){var s;this.mt[0]=seed>>>0;for(this.mti=1;this.mti<this.N;this.mti++){s=this.mt[this.mti-1]^(this.mt[this.mti-1]>>>30);this.mt[this.mti]=(((((s&0xffff0000)>>>16)*1812433253)<<16)+(s&0x0000ffff)*1812433253)+this.mti;this.mt[this.mti]>>>=0;}},seedArray:function(vector){var i=1,j=0,k=this.N>vector.length?this.N:vector.length,s;this.seed(19650218);for(;k>0;k--){s=this.mt[i-1]^(this.mt[i-1]>>>30);this.mt[i]=(this.mt[i]^(((((s&0xffff0000)>>>16)*1664525)<<16)+((s&0x0000ffff)*1664525)))+
vector[j]+j;this.mt[i]>>>=0;i++;j++;if(i>=this.N){this.mt[0]=this.mt[this.N-1];i=1;}
if(j>=vector.length){j=0;}}
for(k=this.N-1;k;k--){s=this.mt[i-1]^(this.mt[i-1]>>>30);this.mt[i]=(this.mt[i]^(((((s&0xffff0000)>>>16)*1566083941)<<16)+(s&0x0000ffff)*1566083941))-i;this.mt[i]>>>=0;i++;if(i>=this.N){this.mt[0]=this.mt[this.N-1];i=1;}}
this.mt[0]=0x80000000;},int:function(){var y,kk,mag01=new Array(0,this.MATRIX_A);if(this.mti>=this.N){if(this.mti===this.N+1){this.seed(5489);}
for(kk=0;kk<this.N-this.M;kk++){y=(this.mt[kk]&this.UPPER_MARK)|(this.mt[kk+1]&this.LOWER_MASK);this.mt[kk]=this.mt[kk+this.M]^(y>>>1)^mag01[y&1];}
for(;kk<this.N-1;kk++){y=(this.mt[kk]&this.UPPER_MARK)|(this.mt[kk+1]&this.LOWER_MASK);this.mt[kk]=this.mt[kk+(this.M-this.N)]^(y>>>1)^mag01[y&1];}
y=(this.mt[this.N-1]&this.UPPER_MARK)|(this.mt[0]&this.LOWER_MASK);this.mt[this.N-1]=this.mt[this.M-1]^(y>>>1)^mag01[y&1];this.mti=0;}
y=this.mt[this.mti++];y^=(y>>>11);y^=(y<<7)&0x9d2c5680;y^=(y<<15)&0xefc60000;y^=(y>>>18);return y>>>0;},int31:function(){return this.int()>>>1;},real:function(){return this.int()*(1.0/(this.MAX_INT-1));},realInRange:function(min,max){min=min||0;max=max||0;return this.real()*(max-min)+min;},integerInRange:function(min,max){return Math.floor(this.realInRange(min,max));},realx:function(){return(this.int()+0.5)*(1.0/this.MAX_INT);},rnd:function(){return this.int()*(1.0/this.MAX_INT);},rndHiRes:function(){var a=this.int()>>>5,b=this.int()>>>6;return(a*67108864.0+b)*(1.0/9007199254740992.0);}};﻿var DataStorage={};DataStorage.Database=function(syscookie){this.systemcookie=syscookie;};DataStorage.Database.prototype={save:function(key,value,dateOffset){var date=new Date();date.setTime(date.getTime()+((dateOffset?dateOffset:365*10)*24*60*60*1000));document.cookie=this.systemcookie+"~"+key+"="+value+"; expires="+date.toUTCString()+"; path=/";},load:function(key){var nameeq=this.systemcookie+"~"+key+"=";var ca=document.cookie.split(";");var rt;for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' '){c=c.substring(1,c.length);}
if(c.indexOf(nameeq)==0){rt=c.substring(nameeq.length,c.length);return rt;}}
return null;}};DataStorage.supportsLocalStorage=function(){try{return'localStorage'in window&&window['localStorage']!==null;}catch(e){return false;}};DataStorage.GlobalSettings={database:new DataStorage.Database('gamepyong_'+Utils.GlobalSettings.namespace)};﻿(function(cocoonjsphaser){cocoonjsphaser.utils={fixDOMParser:function(){window.DOMParser=DOMishParser;}};function DOMishParser(){}
DOMishParser.prototype.parseFromString=function(data){return new DOMishObject(JSON.parse(data));};function DOMishAttributes(){}
DOMishAttributes.prototype.getNamedItem=function(name){return{nodeValue:this[name]||null};};function makeDOMishObject(data){return new DOMishObject(data);}
function DOMishObject(data){this.attributes=this.convertContent(data);this.length=Object.keys(this.attributes).length;}
DOMishObject.prototype.documentElement=document;DOMishObject.prototype.convertContent=function(obj){var attributes=new DOMishAttributes(),prop;for(prop in obj){if(obj[prop]!==null&&typeof obj[prop]==='object'){attributes[prop]=Array.isArray(obj[prop])?obj[prop].map(makeDOMishObject):new DOMishObject(obj[prop]);}else{attributes[prop]=obj[prop];}}
return attributes;};DOMishObject.prototype.getElementsByTagName=function(name){return this.attributes[name]?Array.isArray(this.attributes[name])?this.attributes[name]:[this.attributes[name]]:[];};DOMishObject.prototype.getAttribute=function(name){return this.attributes.getNamedItem(name).nodeValue;};}(window.cocoonjsphaser=window.cocoonjsphaser||{}));﻿
Utils.Particle=function(pos,target,vel,marker,usePhysics,type){this.reset(pos,target,vel,marker,usePhysics,type);};Utils.Particle.prototype={reset:function(pos,target,vel,marker,usePhysics,type,img){this.GRAVITY=0.06;this.alpha=1;this.easing=Math.random()*0.02;this.fade=Math.random()*0.1;this.gridX=marker%120;this.gridY=Math.floor(marker/120)*12;this.color=marker;this.type=type;this.image=img||'small-glow';this.pos={x:pos.x||0,y:pos.y||0};this.vel={x:vel.x||0,y:vel.y||0};this.lastPos={x:this.pos.x,y:this.pos.y};this.target={y:target.y||0};this.usePhysics=usePhysics||false;},update:function(){this.lastPos.x=this.pos.x;this.lastPos.y=this.pos.y;if(this.usePhysics){this.vel.y+=this.GRAVITY;this.pos.y+=this.vel.y;this.alpha-=this.fade;}else{var distance=(this.target.y-this.pos.y);this.pos.y+=distance*(0.03+this.easing);this.alpha=Math.min(distance*distance*0.00005,1);}
this.pos.x+=this.vel.x;return(this.alpha<0.05||this.pos.y>Utils.GlobalSettings.height||this.pos.x<0||this.pos.x>Utils.GlobalSettings.width);},render:function(mainCanvas,context,fireworkCanvas){var x=Math.round(this.pos.x),y=Math.round(this.pos.y),xVel=(x-this.lastPos.x)*-5,yVel=(y-this.lastPos.y)*-5;context.save();context.fillStyle="hsl("+Math.round((this.color/12)*3.6)+",100%,60%)";context.beginPath();context.moveTo(this.pos.x,this.pos.y);context.lineTo(this.pos.x+1.5,this.pos.y);context.lineTo(this.pos.x+xVel,this.pos.y+yVel);context.lineTo(this.pos.x-1.5,this.pos.y);context.closePath();context.fill();mainCanvas.draw(this.image,x-3,y-3);context.restore();},destroy:function(){this.image=null;this.pos=null;this.vel=null;this.lastPos=null;this.target=null;}};Utils.Fireworks=function(game,state){this.game=game;this.state=state;this.particles=[];this.particlePool=[];this.poolMarker=0;this.poolSize=0;this.fadeTimer=0;};Utils.Fireworks.prototype={init:function(){this.mainCanvas=this.game.add.bitmapData(Utils.GlobalSettings.width,Utils.GlobalSettings.height);this.mainContext=this.mainCanvas.context;this.mainCanvas.cls();this.mainCanvas.addToWorld();this.expandPool(500);},createFirework:function(fireworkImg){this.createParticle(null,null,null,null,null,null,fireworkImg);this.fadeTimer=0;},createSpark:function(x,y){this.createParticle({x:x,y:y},{x:x,y:y},null,null,null,1);this.fadeTimer=0;},createFireworks:function(n){for(var i=0;i<n;i++){this.createParticle();}
this.fadeTimer=0;},clearContext:function(){this.fadeTimer+=0.001;if(this.fadeTimer>=1){this.fadeTimer=0;}
this.mainCanvas.fill(0,0,0,this.fadeTimer);},circle:function(firework){var count=Utils.GlobalSettings.isMobile?20:40;var angle=(Math.PI*2)/count;while(count--){var randomVelocity=4+Math.random()*4;var particleAngle=count*angle;this.createParticle(firework.pos,null,{x:Math.cos(particleAngle)*randomVelocity,y:Math.sin(particleAngle)*randomVelocity},firework.color,true,null,firework.image);}},spark:function(firework){var count=5;var angle=(Math.PI*2)/count;while(count--){var randomVelocity=1;var particleAngle=count*angle;this.createParticle(firework.pos,null,{x:Math.cos(particleAngle)*randomVelocity,y:Math.sin(particleAngle)*randomVelocity},firework.color,true,null,firework.image);}},star:function(firework){var points=Utils.GlobalSettings.isMobile?6+Math.round(Math.random()*5):6+Math.round(Math.random()*15);var jump=Utils.GlobalSettings.isMobile?3+Math.round(Math.random()*3):3+Math.round(Math.random()*7);var subdivisions=Utils.GlobalSettings.isMobile?5:10;var radius=80;var randomVelocity=-(Math.random()*3-6);var start=0;var end=0;var circle=Math.PI*2;var adjustment=Math.random()*circle;do{start=end;end=(end+jump)%points;var sAngle=(start/points)*circle-adjustment;var eAngle=((start+jump)/points)*circle-adjustment;var startPos={x:firework.pos.x+Math.cos(sAngle)*radius,y:firework.pos.y+Math.sin(sAngle)*radius};var endPos={x:firework.pos.x+Math.cos(eAngle)*radius,y:firework.pos.y+Math.sin(eAngle)*radius};var diffPos={x:endPos.x-startPos.x,y:endPos.y-startPos.y,a:eAngle-sAngle};for(var s=0;s<subdivisions;s++){var sub=s/subdivisions;var subAngle=sAngle+(sub*diffPos.a);this.createParticle({x:startPos.x+(sub*diffPos.x),y:startPos.y+(sub*diffPos.y)},null,{x:Math.cos(subAngle)*randomVelocity,y:Math.sin(subAngle)*randomVelocity},firework.color,true,null,firework.image);}}while(end!==0);},drawFireworks:function(){var a=this.particles.length;while(a--){var firework=this.particles[a];if(firework){if(firework.update()){if(!firework.usePhysics){if(firework.type===0){if(Math.random()<0.8){this.star(firework);}else{this.circle(firework);}}
else
if(firework.type===1){this.spark(firework);}}
this.particles.splice(a,1);this.returnParticle(firework);}
firework.render(this.mainCanvas,this.mainContext);}}},makeParticle:function(pos,target,vel,color,usePhysics,type,img){pos=pos||{};target=target||{};vel=vel||{};type=type||0;img=img||'small-glow';return new Utils.Particle({x:pos.x||Utils.GlobalSettings.width*0.5,y:pos.y||Utils.GlobalSettings.height+10},{y:target.y||150+Math.random()*100},{x:vel.x||Math.random()*3-1.5,y:vel.y||0},color||Math.floor(Math.random()*100)*12,usePhysics,type,img);},createParticle:function(pos,target,vel,color,usePhysics,type,img){pos=pos||{x:Utils.GlobalSettings.width*0.5,y:Utils.GlobalSettings.height+10};target=target||{y:150+Math.random()*100};vel=vel||{x:Math.random()*3-1.5,y:0};color=color||Math.floor(Math.random()*100)*12;type=type||0;img=img||'small-glow';if(this.poolMarker>=this.poolSize){this.expandPool(this.poolSize*2);}
var obj=this.particlePool[this.poolMarker++];if(obj){obj.index=this.poolMarker-1;obj.reset(pos,target,vel,color,usePhysics,type,img);this.particles.push(obj);}},expandPool:function(newSize){for(var i=0;i<newSize-this.poolSize;++i){this.particlePool.push(this.makeParticle());}
this.poolSize=newSize;},returnParticle:function(particle){this.poolMarker--;var end=this.particlePool[this.poolMarker];var endIndex=end.index;this.particlePool[this.poolMarker]=particle;this.particlePool[particle.index]=end;end.index=particle.index;particle.index=endIndex;},update:function(){this.clearContext();this.drawFireworks();},destroy:function(){var i=0;if(this.particles){for(i=0;i<this.particles.length;i++){if(this.particles[i]){this.particles[i].destroy();this.particles[i]=null;}}
this.particles=null;}
if(this.particlePool){for(i=0;i<this.particlePool.length;i++){if(this.particlePool[i]){this.particlePool[i].destroy();this.particlePool[i]=null;}}
this.particlePool=null;}
if(this.mainCanvas){this.mainCanvas=null;}}};﻿Utils.AdManager=function(){this.listener=null;};Utils.AdManager.prototype={setListener:function(l){this.listener=l;},loadAds:function(){if(navigator.isCocoonJS){var bannerConfig="ca-app-pub-1299265548534590/2541760460";var interstitialConfig="ca-app-pub-1299265548534590/9925426463";if(Phaser.Device.iOS){bannerConfig="ca-app-pub-1299265548534590/8169491662";interstitialConfig="ca-app-pub-1299265548534590/3599691268";}
this.banner=Cocoon.Ad.AdMob.createBanner(bannerConfig);this.bannerLoaded=false;if(this.banner){this.banner.on("load",function(){this.banner.setLayout(Cocoon.Ad.BannerLayout.TOP_CENTER);this.bannerLoaded=true;}.bind(this));this.banner.load();}
this.interstitialLoaded=false;this.interstitial=Cocoon.Ad.AdMob.createInterstitial(interstitialConfig);if(this.interstitial){this.interstitial.on("load",function(){this.interstitialLoaded=true;}.bind(this));this.interstitial.load();}}}};Utils.adManager=new Utils.AdManager();﻿var Entity={};Entity.Missile=function(game,x,y){Phaser.Sprite.call(this,game,x,y,'rocket');this.anchor.setTo(0.5,0.5);this.game.physics.enable(this,Phaser.Physics.ARCADE);this.SPEED=this.game.rnd.integerInRange(100,500);this.TURN_RATE=this.SPEED/50;this.WOBBLE_LIMIT=15;this.WOBBLE_SPEED=250;this.SMOKE_LIFETIME=1000;this.PREVSPEED=this.SPEED;if(Utils.GlobalSettings.isMobile){this.SMOKE_LIFETIME=500;}
this.AVOID_DISTANCE=30;this.wobble=this.WOBBLE_LIMIT;this.game.add.tween(this).to({wobble:-this.WOBBLE_LIMIT},this.WOBBLE_SPEED,Phaser.Easing.Sinusoidal.InOut,true,0,Number.POSITIVE_INFINITY,true);if(Utils.GlobalSettings.isMobile){this.smokeEmitter=this.game.add.emitter(0,0,10);}
else{this.smokeEmitter=this.game.add.emitter(0,0,20);}
this.smokeEmitter.gravity=0;this.smokeEmitter.setXSpeed(0,0);this.smokeEmitter.setYSpeed(-80,-50);this.smokeEmitter.setAlpha(1,0,this.SMOKE_LIFETIME,Phaser.Easing.Linear.InOut);this.smokeEmitter.setScale(1,0,1,0,this.SMOKE_LIFETIME,Phaser.Easing.Linear.InOut);this.smokeEmitter.makeParticles('smoke');this.smokeEmitter.start(false,this.SMOKE_LIFETIME,50);};Entity.Missile.prototype=Object.create(Phaser.Sprite.prototype);Entity.Missile.prototype.constructor=Entity.Missile;Entity.Missile.prototype.setStage=function(stage){this.stage=stage;};Entity.Missile.prototype.doSloMo=function(){this.PREVSPEED=this.SPEED;this.SPEED=50;};Entity.Missile.prototype.endSloMo=function(){this.SPEED=this.PREVSPEED;};Entity.Missile.prototype.update=function(){if(!this.alive){this.smokeEmitter.on=false;return;}else{this.smokeEmitter.on=true;}
if(this.stage.pause){this.body.velocity.x=0;this.body.velocity.y=0;this.smokeEmitter.on=false;return;}
this.smokeEmitter.x=this.x;this.smokeEmitter.y=this.y;var targetAngle=this.game.math.angleBetween(this.x,this.y,this.game.input.activePointer.x,this.game.input.activePointer.y);targetAngle+=this.game.math.degToRad(this.wobble);var avoidAngle=0;this.parent.forEachAlive(function(m){if(this==m)return;if(avoidAngle!==0)return;var distance=this.game.math.distance(this.x,this.y,m.x,m.y);if(distance<this.AVOID_DISTANCE){avoidAngle=Math.PI/2;if(this.game.math.chanceRoll(50))avoidAngle*=-1;}},this);targetAngle+=avoidAngle;if(this.rotation!==targetAngle){var delta=targetAngle-this.rotation;if(delta>Math.PI)delta-=Math.PI*2;if(delta<-Math.PI)delta+=Math.PI*2;if(delta>0){this.angle+=this.TURN_RATE;}else{this.angle-=this.TURN_RATE;}
if(Math.abs(delta)<this.game.math.degToRad(this.TURN_RATE)){this.rotation=targetAngle;}}
this.body.velocity.x=Math.cos(this.rotation)*this.SPEED;this.body.velocity.y=Math.sin(this.rotation)*this.SPEED;};﻿Entity.Candy=function(game,stage,x,y){Phaser.Sprite.call(this,game,x,y,'candy');this.stage=stage;this.anchor.setTo(0.5,0.5);this.timerInterval=0;this.timer=10;};Entity.Candy.prototype=Object.create(Phaser.Sprite.prototype);Entity.Candy.prototype.constructor=Entity.Candy;Entity.Candy.prototype.update=function(){if(!this.alive){return;}
this.angle+=0.5;if(this.frame<76){if(this.timer>0){this.timerInterval+=0.1;if(this.timerInterval>10){this.timerInterval=0;this.timer--;}}
else{this.kill();}}};Entity.Candy.prototype.collect=function(){this.kill();};Entity.Candy.prototype.setup=function(){this.angle=this.game.rnd.integerInRange(0,360);this.timerInterval=0;this.timer=10;this.frame=this.game.rnd.integerInRange(0,this.animations.frameTotal-1);var backupFrame=this.game.rnd.integerInRange(0,this.animations.frameTotal-5);if(this.frame===76&&this.game.rnd.integerInRange(0,2)!==0){this.frame=backupFrame;}
else
if(this.frame===77&&this.game.rnd.integerInRange(0,2)!==0){this.frame=backupFrame;}
else
if(this.frame===78&&this.game.rnd.integerInRange(0,1)!==0){this.frame=backupFrame;}
else
if(this.frame===79&&this.game.rnd.integerInRange(0,5)!==0){this.frame=backupFrame;}
this.scale.x=0;this.scale.y=0;var tween=this.game.add.tween(this.scale).to({x:1,y:1},500,Phaser.Easing.Elastic.Out,true);};﻿var UI={};UI.SubmitNameForm=function(game,state){this.game=game;this.state=state;this.letterArray=[];this.backing=null;this.nicknameText=null;this.headingText=null;};UI.SubmitNameForm.prototype={init:function(){this.backing=this.game.add.sprite(0,0,'backing');this.backing.alpha=0;this.backing.width=Utils.GlobalSettings.width;this.backing.height=Utils.GlobalSettings.height;var tweenBacking=this.game.add.tween(this.backing).to({alpha:0.8},1000,Phaser.Easing.Sinusoidal.Out,true);this.headingText=this.game.add.bitmapText(10,300,'mecha','Please enter your nickname:',50);this.headingText.updateTransform();this.headingText.position.x=Utils.GlobalSettings.width/2-this.headingText.textWidth/2;this.nicknameText=this.game.add.bitmapText(40,400,'mecha',Utils.GlobalSettings.lastNickname,70);this.nicknameText.updateTransform();this.nicknameText.position.x=Utils.GlobalSettings.width/2-this.nicknameText.textWidth/2;this.goButton=this.game.add.button(Utils.GlobalSettings.width-140,400,'letters',null,this,27,27,27);this.goButton.visible=false;if(Utils.GlobalSettings.lastNickname.trim().length>0)
this.goButton.visible=true;this.goButton.events.onInputDown.addOnce(this.goClick.bind(this));var offs=0;var offsi=9;var xp=10;var yp=550;for(var i=0;i<offsi;i++){var letterButton=this.game.add.button(xp+(i*70),yp,'letters',this.letterPressed.bind(this,i),this,i,i,i);this.letterArray.push(letterButton);letterButton=this.game.add.button(xp+(i*70),yp+75,'letters',this.letterPressed.bind(this,i+offsi),this,i+offsi,i+offsi,i+offsi);this.letterArray.push(letterButton);if(i+(offsi*2)<27){letterButton=this.game.add.button(xp+(i*70),yp+(75*2),'letters',this.letterPressed.bind(this,i+(offsi*2)),this,i+(offsi*2),i+(offsi*2),i+(offsi*2));this.letterArray.push(letterButton);}}},letterPressed:function(letterNum){if(!Utils.GlobalSettings.muted){this.state.dripSnd.play();}
var letter='';switch(letterNum){case 0:letter='a';break;case 1:letter='b';break;case 2:letter='c';break;case 3:letter='d';break;case 4:letter='e';break;case 5:letter='f';break;case 6:letter='g';break;case 7:letter='h';break;case 8:letter='i';break;case 9:letter='j';break;case 10:letter='k';break;case 11:letter='l';break;case 12:letter='m';break;case 13:letter='n';break;case 14:letter='o';break;case 15:letter='p';break;case 16:letter='q';break;case 17:letter='r';break;case 18:letter='s';break;case 19:letter='t';break;case 20:letter='u';break;case 21:letter='v';break;case 22:letter='w';break;case 23:letter='x';break;case 24:letter='y';break;case 25:letter='z';break;}
if(letterNum===26){if(Utils.GlobalSettings.lastNickname.length>0){Utils.GlobalSettings.lastNickname=Utils.GlobalSettings.lastNickname.substring(0,Utils.GlobalSettings.lastNickname.length-1);this.nicknameText.setText(Utils.GlobalSettings.lastNickname);this.nicknameText.updateTransform();this.nicknameText.position.x=Utils.GlobalSettings.width/2-this.nicknameText.textWidth/2;}}
else{if(Utils.GlobalSettings.lastNickname.length<5){Utils.GlobalSettings.lastNickname+=letter;this.nicknameText.setText(Utils.GlobalSettings.lastNickname);this.nicknameText.updateTransform();this.nicknameText.position.x=Utils.GlobalSettings.width/2-this.nicknameText.textWidth/2;}}
if(this.nicknameText.text.trim().length>0)
this.goButton.visible=true;else
this.goButton.visible=false;},goClick:function(){if(!Utils.GlobalSettings.muted){this.state.clickSnd.play();}
this.goButton.events.onInputDown.removeAll();this.game.state.start('introscreen',Phaser.Plugin.StateTransition.Out.SlideLeft,Phaser.Plugin.StateTransition.In.SlideLeft);},destroy:function(){if(this.letterArray){for(var i=0;i<this.letterArray.length;i++){if(this.letterArray[i]){this.letterArray[i].destroy();this.letterArray[i]=null;}}
this.letterArray=null;}
if(this.backing){this.backing.destroy();this.backing=null;}
if(this.nicknameText){this.nicknameText.destroy();this.nicknameText=null;}
if(this.headingText){this.headingText.destroy();this.headingText=null;}
if(this.goButton){this.goButton.destroy();this.goButton=null;}
console.log('destroy submitscoreform');}};﻿var Screen={};Screen.Boot=function(game){this.game=game;};Screen.Boot.prototype={setupScaling:function(){if(navigator.isCocoonJS){this.game.scale.scaleMode=Phaser.ScaleManager.EXACT_FIT;this.game.scale.pageAlignHorizontally=true;this.game.scale.pageAlignVertically=true;}
else{if(this.game.device.desktop){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL;this.game.scale.pageAlignHorizontally=true;this.game.scale.pageAlignVertically=true;}
else{this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL;this.game.scale.pageAlignHorizontally=true;this.game.scale.pageAlignVertically=true;this.game.scale.forceOrientation(false,true,'orientation');}
this.game.world.setBounds(0,0,Utils.GlobalSettings.width,Utils.GlobalSettings.height);}},preload:function(){this.game.load.image('loaderFull','assets/loadingFull.png');this.game.load.image('loaderEmpty','assets/loadingEmpty.png');this.game.load.image('orientation','assets/orientation.jpg');},create:function(){this.setupScaling();if(this.game.device.desktop){Utils.GlobalSettings.isMobile=false;}
else{Utils.GlobalSettings.isMobile=true;}
if(navigator.isCocoonJS){if(Utils.adManager){Utils.adManager.loadAds();}}
this.game.forceSingleUpdate=true;this.game.state.start('preloader');}};﻿Screen.Preloader=function(game){this.game=game;};Screen.Preloader.prototype={loaded:false,ready:false,preload:function(){this.loaderEmpty=this.game.add.sprite(0,0,'loaderEmpty');this.loaderEmpty.x=Utils.GlobalSettings.width/2-this.loaderEmpty.width/2;this.loaderEmpty.y=Utils.GlobalSettings.height-150;this.loaderFull=this.game.add.sprite(0,0,'loaderFull');this.loaderFull.x=Utils.GlobalSettings.width/2-this.loaderFull.width/2;this.loaderFull.y=Utils.GlobalSettings.height-150;this.game.load.image('backing','assets/backing.png');this.game.load.image('bg','assets/bg.jpg');this.game.load.image('panel','assets/panel.png');this.game.load.image('rocket','assets/rocket.png');this.game.load.image('smoke','assets/smoke.png');this.game.load.image('gameover','assets/gameover.png');this.game.load.image('title','assets/title.png');this.game.load.image('invincibleimg','assets/invincible.png');this.game.load.image('lifeupimg','assets/lifeup.png');this.game.load.image('slomoimg','assets/slowmo.png');this.game.load.image('ghostimg','assets/ghost.png');this.game.load.image('comic1','assets/1.jpg');this.game.load.image('comic2','assets/2.jpg');this.game.load.image('comic3','assets/3.jpg');this.game.load.image('comic4','assets/4.jpg');this.game.load.image('comic5','assets/5.jpg');this.game.load.image('comic6','assets/6.jpg');this.game.load.spritesheet('collect','assets/explosionred01.png',82,82);this.game.load.spritesheet('explosion','assets/explosion.png',128,128);this.game.load.spritesheet('candy','assets/candy.png',64,64);this.game.load.spritesheet('player','assets/player.png',100,64);this.game.load.spritesheet('systembuttons','assets/systembuttons.png',80,84);this.game.load.spritesheet('letters','assets/letters.png',64,64);this.game.load.spritesheet('restart','assets/restart.png',80,80);this.game.load.spritesheet('play','assets/play.png',80,80);this.game.load.spritesheet('circle','assets/circle.png',80,80);this.game.load.spritesheet('circle2','assets/circle2.png',60,60);this.game.load.spritesheet('levelbuttonprops','assets/levelbuttonprops.png',32,25);this.game.load.atlas('atlas','assets/spritesheet.png','assets/sprites.json');this.game.load.audio('gp',['assets/audio/gp.ogg']);this.game.load.audio('click',['assets/audio/click.ogg']);this.game.load.audio('drip',['assets/audio/drip.ogg']);this.game.load.audio('invincible',['assets/audio/correct.ogg']);this.game.load.audio('wrong',['assets/audio/wrong.ogg']);this.game.load.audio('coin',['assets/audio/coin.ogg']);this.game.load.audio('flip2',['assets/audio/bookFlip3.ogg']);this.game.load.audio('flip1',['assets/audio/bookFlip2.ogg']);this.game.load.audio('explosion',['assets/audio/explosion.ogg']);this.game.load.audio('dead',['assets/audio/enemydead.ogg']);this.game.load.audio('life',['assets/audio/buff.ogg']);this.game.load.audio('bgm',['assets/audio/bgm.ogg']);this.game.load.bitmapFont('mecha','assets/fonts/mecha_0.png','assets/fonts/mecha'+(navigator.isCocoonJS?'.json':'.xml'));this.game.load.bitmapFont('arial','assets/fonts/arial_0.png','assets/fonts/arial'+(navigator.isCocoonJS?'.json':'.xml'));this.game.load.bitmapFont('fader','assets/fonts/fader_0.png','assets/fonts/fader'+(navigator.isCocoonJS?'.json':'.xml'));this.game.load.text('text','assets/text.json');this.game.load.onFileComplete.add(this.fileLoaded,this);this.game.load.setPreloadSprite(this.loaderFull);this.game.add.sprite(0,0,'');},fileLoaded:function(progress,cacheID,success,filesLoaded,totalFiles){if(filesLoaded===totalFiles&&!this.loaded){this.loaded=true;}},update:function(){if(!this.ready&&this.loaded){this.ready=true;Utils.GlobalSettings.text=JSON.parse(this.game.cache.getText('text'));Utils.BackgroundMusic.load(this.game);this.game.state.start('splashscreen',Phaser.Plugin.StateTransition.Out.SlideRight,Phaser.Plugin.StateTransition.In.SlideRight);}},shutdown:function(){if(this.loaderEmpty){this.loaderEmpty.destroy();this.loaderEmpty=null;}
if(this.loaderFull){this.loaderFull.destroy();this.loaderFull=null;}}};﻿Screen.SplashScreen=function(game){this.game=game;};Screen.SplashScreen.prototype={create:function(){this.gp=this.game.add.audio('gp');this.gp.play();this.logo=this.game.add.sprite(0,0,'atlas','logo');this.logo.x=Utils.GlobalSettings.width/2-this.logo.width/2;this.logo.y=Utils.GlobalSettings.height/2-this.logo.height/2;this.logo.scale.x=20;this.logo.scale.y=20;this.tween=this.game.add.tween(this.logo.scale).to({x:1,y:1},1000,Phaser.Easing.Sinusoidal.Out,true);this.tween2=this.game.add.tween(this.logo).to({alpha:0},500);this.tween.chain(this.tween2);this.tween2.onComplete.add(this.done.bind(this));this.game.add.sprite(0,0,'');},done:function(){if(!Utils.GlobalSettings.muted){}
this.game.state.start('mainmenu',Phaser.Plugin.StateTransition.Out.SlideRight,Phaser.Plugin.StateTransition.In.SlideRight);},update:function(){},shutdown:function(){if(this.gp){this.gp.stop();this.gp.destroy();this.gp=null;}
if(this.logo){this.logo.destroy();this.logo=null;}
if(this.tween){this.tween.stop();this.tween=null;}
if(this.tween2){this.tween2.onComplete.removeAll();this.tween2.stop();this.tween2=null;}}};﻿Screen.MainMenu=function(game){this.game=game;};Screen.MainMenu.prototype={create:function(){this.setup();},setup:function(){Utils.GlobalSettings.load();this.colors=Phaser.Color.HSVColorWheel();this.clickSnd=this.game.add.audio('click');this.dripSnd=this.game.add.audio('drip');this.bg=this.game.add.image(0,0,'bg');this.bg.alpha=0.8;var i;var spr;this.candyPool=this.game.add.group();for(i=0;i<20;i++){spr=this.candyPool.create(this.game.rnd.integerInRange(-100,Utils.GlobalSettings.width+100),this.game.rnd.integerInRange(-50,Utils.GlobalSettings.height-100),'candy');spr.frame=this.game.rnd.integerInRange(0,79);spr.alpha=this.game.rnd.realInRange(0.1,0.3);spr._xspeed=this.game.rnd.realInRange(-0.3,0.3);spr._yspeed=this.game.rnd.realInRange(1.2,1.4);spr._curYSpeed=0;spr.scale.set(this.game.rnd.realInRange(0.3,0.6));spr.anchor.setTo(0.5);}
Utils.BackgroundMusic.bgm1.restart('',0,0.3,true);this.title=this.game.add.image(Utils.GlobalSettings.width/2,-500,'title');this.title.anchor.setTo(0.5);var titletween=this.game.add.tween(this.title).to({y:100},1000,Phaser.Easing.Bounce.Out,true);this.playButton=this.game.add.button(Utils.GlobalSettings.width/2,Utils.GlobalSettings.height-200,'play',null,this,1,0,1);this.playButton.anchor.setTo(0.5);this.playButton.alpha=0;this.playButton.events.onInputDown.addOnce(this.playClick.bind(this));var tween=this.game.add.tween(this.playButton).to({alpha:1},1000,Phaser.Easing.Linear.Out,true,0);this.credits=["Code - Hsaka","Made with - Phaser [phaser.io]","Music - Snabisch"];this.creditIndex=0;this.creditText=this.game.add.bitmapText(0,0,'mecha',this.credits[this.creditIndex],40);this.creditText.x=Utils.GlobalSettings.width+1000;this.creditText.y=Utils.GlobalSettings.height-100;this.creditTween=this.game.add.tween(this.creditText).to({x:0},2000,Phaser.Easing.Sinusoidal.Out).to({y:Utils.GlobalSettings.height-70},1000,Phaser.Easing.Sinusoidal.In).to({y:Utils.GlobalSettings.height+100},500,Phaser.Easing.Back.In);this.creditTween.onComplete.add(this.creditDone.bind(this));this.creditTween.start();this.setupLeaderboard();if(!navigator.isCocoonJS){this.nameForm=new UI.SubmitNameForm(this.game,this);}
this.soundButton=null;if(!Utils.GlobalSettings.muted){this.soundButton=this.game.add.button(Utils.GlobalSettings.width-60,5,'systembuttons',null,this,7,6,7);}
else{this.soundButton=this.game.add.button(Utils.GlobalSettings.width-60,5,'systembuttons',null,this,9,8,9);}
this.soundButton.width=50;this.soundButton.height=50;this.soundButton.events.onInputDown.addOnce(this.soundClick.bind(this));this.stopMusicOnLoad=false;this.game.add.sprite(0,0,'');},setupLeaderboard:function(){this.leaderboardGroup=this.game.add.group();this.backing=this.game.add.image(Utils.GlobalSettings.width/2-170,Utils.GlobalSettings.height-610,'backing');this.backing.alpha=0.6;this.backing.width=340;this.backing.height=310;this.leaderboardGroup.add(this.backing);this.leaderboardLabel=this.game.add.bitmapText(Utils.GlobalSettings.width/2-100,Utils.GlobalSettings.height-700,'mecha','Highscores',40);this.leaderboardLabel.updateTransform();this.leaderboardLabel.position.x=Utils.GlobalSettings.width/2-this.leaderboardLabel.textWidth/2;this.leaderboardGroup.add(this.leaderboardLabel);this.nameLabel=this.game.add.bitmapText(Utils.GlobalSettings.width/2-110,Utils.GlobalSettings.height-640,'mecha','Name',34);this.scoreLabel=this.game.add.bitmapText(Utils.GlobalSettings.width/2+50,Utils.GlobalSettings.height-640,'mecha','Score',34);this.leaderboardGroup.add(this.nameLabel);this.leaderboardGroup.add(this.scoreLabel);this.updateButton=this.game.add.button(Utils.GlobalSettings.width-160,Utils.GlobalSettings.height-660,'systembuttons',this.updateClick,this,19,18,19);this.updateButton.scale.setTo(0.6);this.leaderboardGroup.add(this.updateButton);this.updateTween=this.game.add.tween(this.updateButton).to({alpha:1},5000,Phaser.Easing.Sinusoidal.Out,false);this.names=[];this.scores=[];for(var i=0;i<10;i++){this.names.push(this.game.add.bitmapText(Utils.GlobalSettings.width/2-100,Utils.GlobalSettings.height-600+(i*30),'mecha','',24));this.scores.push(this.game.add.bitmapText(Utils.GlobalSettings.width/2+60,Utils.GlobalSettings.height-600+(i*30),'mecha','',24));this.leaderboardGroup.add(this.names[i]);this.leaderboardGroup.add(this.scores[i]);}
this.leaderboardGroup.visible=true;this.leaderboardGroup.alpha=0;var tween=this.game.add.tween(this.leaderboardGroup).to({alpha:1},1000,Phaser.Easing.Sinusoidal.Out,true,0);this.updateLeaderboard();},updateClick:function(){if(this.updateButton.alpha===1){if(!Utils.GlobalSettings.muted){this.clickSnd.play();}
this.updateButton.alpha=0;this.updateTween.start();this.updateLeaderboard();}},updateLeaderboard:function(){var xmlHttp=new XMLHttpRequest();xmlHttp.open("POST","http://www.gamepyong.com/firewords/php/firewords.php",true);var parameters="action=gethighscores";xmlHttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");xmlHttp.onreadystatechange=function(){if(xmlHttp.readyState==4&&xmlHttp.status==200){var msg=xmlHttp.responseText;if(msg&&msg.length>0&&this.names&&this.scores&&this.names.length===10&&this.scores.length===10){var data=msg.split('#');if(data&&data.length>0){var part=null;for(var i=0;i<data.length;i++){part=data[i].split(',');if(part&&part.length===2){if(part[0]===Utils.GlobalSettings.lastNickname){this.names[i].tint=0xFFFFFF;this.scores[i].tint=0xFFFFFF;}
else{this.names[i].tint=Utils.GlobalSettings.getHexValue(this.colors[i*23]);this.scores[i].tint=Utils.GlobalSettings.getHexValue(this.colors[i*23]);}
this.names[i].setText((i+1)+'.  '+part[0]);this.scores[i].setText(''+part[1]);}}}}}}.bind(this);xmlHttp.ontimeout=function(){}.bind(this);xmlHttp.send(parameters);},playClick:function(){if(!Utils.GlobalSettings.muted){this.clickSnd.play();}
this.playButton.events.onInputDown.removeAll();this.playButton.events.onInputDown.addOnce(this.playClick.bind(this));Utils.GlobalSettings.mode=0;if(Utils.GlobalSettings.lastNickname.trim().length===0){if(navigator.isCocoonJS){Cocoon.Dialog.prompt({title:"Firewords",message:"Enter your nickname:",text:"",type:Cocoon.Dialog.keyboardType.TEXT,cancelText:"Cancel",confirmText:"Ok"},{success:this.confirmDialog.bind(this),cancel:function(){this.playButton.visible=true;this.leaderboardGroup.visible=true;}.bind(this)});}
else{this.nameForm.init();}}
else{this.game.state.start('gamescreen',Phaser.Plugin.StateTransition.Out.SlideLeft,Phaser.Plugin.StateTransition.In.SlideLeft);}
this.playButton.visible=false;this.leaderboardGroup.visible=false;},confirmDialog:function(text){if(text&&text.length>0){text=""+text;Utils.GlobalSettings.lastNickname=text;this.game.state.start('introscreen',Phaser.Plugin.StateTransition.Out.SlideLeft,Phaser.Plugin.StateTransition.In.SlideLeft);}
else{this.playButton.visible=true;this.leaderboardGroup.visible=true;}},soundClick:function(){Utils.GlobalSettings.muted=!Utils.GlobalSettings.muted;if(!Utils.GlobalSettings.muted){this.clickSnd.play();this.soundButton.setFrames(7,6,7);Utils.BackgroundMusic.bgm1.restart('',0,0.3,true);}
else{this.soundButton.setFrames(9,8,9);Utils.BackgroundMusic.bgm1.pause();}
this.soundButton.events.onInputDown.removeAll();this.soundButton.events.onInputDown.addOnce(this.soundClick.bind(this));},creditDone:function(){if(this.credits){this.creditIndex++;if(this.creditIndex>=this.credits.length)
this.creditIndex=0;this.creditText.setText(this.credits[this.creditIndex]);this.creditText.x=Utils.GlobalSettings.width+1000;this.creditText.y=Utils.GlobalSettings.height-100;}
this.creditTween.start();},updateCandy:function(candy){if(candy){if(candy.y>=0&&(!candy.inWorld||candy.y>Utils.GlobalSettings.height+200)){candy.x=this.game.rnd.integerInRange(-100,Utils.GlobalSettings.width-100);candy.y=this.game.rnd.integerInRange(-candy.height-100,-candy.height-200);candy.frame=this.game.rnd.integerInRange(0,51);candy.alpha=this.game.rnd.realInRange(0.1,0.3);candy._xspeed=this.game.rnd.realInRange(-0.3,0.3);candy._yspeed=this.game.rnd.realInRange(1.2,1.4);candy.scale.set(this.game.rnd.realInRange(0.3,0.6));}
else{candy.x+=candy._xspeed;if(candy.alpha>0){candy.alpha-=0.0002;}
candy.angle++;if(candy.angle>360){candy.angle=0;}
if(candy._curYSpeed<candy._yspeed){candy._curYSpeed+=0.01;}
else{candy._curYSpeed=candy._yspeed;}
candy.y+=candy._curYSpeed;}}},update:function(){if(Utils.GlobalSettings.muted&&!this.stopMusicOnLoad&&this.game.cache.isSoundDecoded('bgm')){this.stopMusicOnLoad=true;Utils.BackgroundMusic.bgm1.pause();}
this.candyPool.forEachAlive(this.updateCandy,this);},shutdown:function(){this.credits=null;this.colors=null;if(this.creditText){this.creditText.destroy();this.creditText=null;}
if(this.creditTween){this.creditTween.onComplete.removeAll();this.creditTween.stop();this.creditTween=null;}
if(this.clickSnd){this.clickSnd.stop();this.clickSnd.destroy();this.clickSnd=null;}
if(this.dripSnd){this.dripSnd.stop();this.dripSnd.destroy();this.dripSnd=null;}
if(this.soundButton){this.soundButton.destroy();this.soundButton=null;}
if(this.bg){this.bg.destroy();this.bg=null;}
if(this.candyPool){this.candyPool.destroy();this.candyPool=null;}
if(this.title){this.title.destroy();this.title=null;}
if(this.playButton){this.playButton.destroy();this.playButton=null;}
if(this.leaderboardGroup){this.leaderboardGroup.destroy();this.leaderboardGroup=null;}
if(this.backing){this.backing.destroy();this.backing=null;}
if(this.leaderboardLabel){this.leaderboardLabel.destroy();this.leaderboardLabel=null;}
if(this.nameLabel){this.nameLabel.destroy();this.nameLabel=null;}
if(this.scoreLabel){this.scoreLabel.destroy();this.scoreLabel=null;}
if(this.updateButton){this.updateButton.destroy();this.updateButton=null;}
if(this.updateTween){this.updateTween.stop();this.updateTween=null;}
if(this.names&&this.scores){for(var i=0;i<this.names.length;i++){this.names[i].destroy();this.scores[i].destroy();}
this.names=null;this.scores=null;}
if(this.equipButton){this.equipButton.destroy();this.equipButton=null;}
if(this.equipLabel){this.equipLabel.destroy();this.equipLabel=null;}
Utils.GlobalSettings.fromScreen='mainmenu';console.log('destroy mainmenu');}};﻿Screen.KiteEquipScreen=function(game){this.game=game;};Screen.KiteEquipScreen.prototype={create:function(){this.setup();},setup:function(){Utils.GlobalSettings.load();this.clickSnd=this.game.add.audio('click');this.flip1Snd=this.game.add.audio('flip1');this.flip2Snd=this.game.add.audio('flip2');this.bg=this.game.add.image(Utils.GlobalSettings.width/2,Utils.GlobalSettings.height/2,'bg');this.bg.anchor.set(0.5);this.bg.alpha=0;this.levelselectbg=this.game.add.image(Utils.GlobalSettings.width/2,Utils.GlobalSettings.height/2+20,'panel');this.levelselectbg.anchor.set(0.5);this.levelselectbg.scale.set(0);this.prevButton=this.game.add.button(-100,Utils.GlobalSettings.height-130,'systembuttons',null,this,12,12,12);this.nextButton=this.game.add.button(Utils.GlobalSettings.width+20,Utils.GlobalSettings.height-130,'systembuttons',null,this,14,14,14);this.prevButton.events.onInputDown.addOnce(this.prevClick.bind(this));this.nextButton.events.onInputDown.addOnce(this.nextClick.bind(this));this.okButton=this.game.add.button(Utils.GlobalSettings.width/2,Utils.GlobalSettings.height-130,'systembuttons',null,this,17,16,17);this.okButton.anchor.set(0.5);this.okButton.scale.set(0);this.okButton.events.onInputDown.addOnce(this.okClick.bind(this));this.equippedButton=this.game.add.button(60,60,'letters',null,this,0,0,0);this.equippedButton.anchor.set(0.5);this.equippedTxt=this.game.add.bitmapText(30,90,'mecha','Selected',20);this.equippedItemTxt=this.game.add.bitmapText(this.equippedButton.x,10,'mecha','',20);this.coinsText=this.game.add.bitmapText(20,130,'mecha',''+Utils.GlobalSettings.coins,72);this.coinsText.alpha=0;this.itemButtons=[];this.itemButtonCostTxts=[];this.itemButtonProp=[];var costTxt;var prop;var yp=300;var xp=0;var itembuttontween;var costtxttween;var proptween;var itemIndex=0;this.page=0;this.maxItems=Utils.GlobalSettings.itemsAvailable.length;for(var i=0;i<12;i++){spr=this.game.add.button(110+(xp*140),yp,'letters',null,this,0,0,0);spr.anchor.set(0.5);spr.scale.set(0);spr.events.onInputDown.addOnce(this.kiteButtonClick.bind(this,i));costTxt=this.game.add.bitmapText(110+(xp*140),yp+50,'mecha','',25);costTxt.tint=0x555555;costTxt.alpha=0;costTxt.visible=true;prop=this.game.add.image(120+(xp*140),yp-70,'levelbuttonprops',0);prop.alpha=0;prop.visible=true;if(i<Utils.GlobalSettings.itemsAvailable.length){if(Utils.GlobalSettings.itemsAvailable[i]===-1){prop.frame=1;}
else{prop.visible=false;costTxt.visible=false;}}
else{prop.frame=1;}
itemIndex=i+1;if(itemIndex>this.maxItems){spr.setFrames(0,0,0,0);costTxt.setText('');spr.alpha=0.2;}
else{spr.setFrames(itemIndex-1,itemIndex-1,itemIndex-1,itemIndex-1);costTxt.setText('100 Coins');spr.alpha=1;}
costTxt.updateTransform();costTxt.position.x=110+(xp*140)-costTxt.textWidth/2;xp++;if(i===3||i==7){yp+=200;xp=0;}
this.itemButtons.push(spr);this.itemButtonCostTxts.push(costTxt);this.itemButtonProp.push(prop);itembuttontween=this.game.add.tween(spr.scale).to({x:1.4,y:1.4},1000,Phaser.Easing.Elastic.Out,false,1600+(i*25));itembuttontween.start();costtxttween=this.game.add.tween(costTxt).to({alpha:1},1000,Phaser.Easing.Linear.Out,false,1600+(i*50));costtxttween.start();proptween=this.game.add.tween(prop).to({alpha:1},1000,Phaser.Easing.Linear.Out,false,1600+(i*50));proptween.start();}
var bgtween=this.game.add.tween(this.bg).to({alpha:0.3},500,Phaser.Easing.Linear.Out);var levelselectbgTween=this.game.add.tween(this.levelselectbg.scale).to({x:1,y:1},1000,Phaser.Easing.Back.Out,false,500);var prevTween=this.game.add.tween(this.prevButton).to({x:30},1000,Phaser.Easing.Sinusoidal.Out,false,1500);var nextTween=this.game.add.tween(this.nextButton).to({x:Utils.GlobalSettings.width-110},1000,Phaser.Easing.Sinusoidal.Out,false,1500);var okTween=this.game.add.tween(this.okButton.scale).to({x:1,y:1},1000,Phaser.Easing.Elastic.Out,false,1500);var coinTextTween=this.game.add.tween(this.coinsText).to({alpha:1},1000,Phaser.Easing.Linear.Out,false,2000);bgtween.start();levelselectbgTween.start();prevTween.start();nextTween.start();okTween.start();coinTextTween.start();if(Utils.GlobalSettings.itemSelected===-1){this.equippedButton.visible=false;this.equippedTxt.visible=false;this.equippedItemTxt.visible=false;}
else{this.equippedButton.visible=true;this.equippedTxt.visible=true;this.equippedButton.setFrames(Utils.GlobalSettings.itemSelected,Utils.GlobalSettings.itemSelected,Utils.GlobalSettings.itemSelected,Utils.GlobalSettings.itemSelected);this.equippedButton.scale.set(0);this.equippedTxt.alpha=0;this.equippedItemTxt.visible=true;this.equippedItemTxt.setText('Kite');this.equippedItemTxt.updateTransform();this.equippedItemTxt.position.x=this.equippedButton.x-this.equippedItemTxt.textWidth/2;this.equippedItemTxt.alpha=0;var equippedButtonTween=this.game.add.tween(this.equippedButton.scale).to({x:1,y:1},1000,Phaser.Easing.Elastic.Out,false,1500);equippedButtonTween.start();var equippedTxtTween=this.game.add.tween(this.equippedTxt).to({alpha:1},1000,Phaser.Easing.Linear.Out,false,1500);equippedTxtTween.start();var kiteTxtTween=this.game.add.tween(this.equippedItemTxt).to({alpha:1},1000,Phaser.Easing.Linear.Out,false,1500);kiteTxtTween.start();}
this.statusMsgTxt=this.game.add.bitmapText(0,0,'mecha','',25);this.statusMsgTxt.alpha=0;this.statusMsgTxt.visible=false;this.soundButton=null;if(!Utils.GlobalSettings.muted){this.soundButton=this.game.add.button(Utils.GlobalSettings.width-120,5,'systembuttons',null,this,7,6,7);}
else{this.soundButton=this.game.add.button(Utils.GlobalSettings.width-120,5,'systembuttons',null,this,9,8,9);}
this.soundButton.width=50;this.soundButton.height=50;this.soundButton.events.onInputDown.addOnce(this.soundClick.bind(this));this.stopMusicOnLoad=false;this.exitButton=this.game.add.button(Utils.GlobalSettings.width-60,5,'systembuttons',null,this,5,4,5);this.exitButton.width=50;this.exitButton.height=50;this.exitButton.events.onInputDown.addOnce(this.exitClick.bind(this));this.stopMusicOnLoad=false;if(navigator.isCocoonJS){this.exitHandler=this.exitClick.bind(this);document.addEventListener("backbutton",this.exitHandler,false);}
this.startX=0;this.startY=0;this.endX=0;this.endY=0;this.game.input.onDown.removeAll();this.game.input.onUp.removeAll();this.game.input.onDown.add(this.beginSwipe.bind(this));this.game.add.sprite(0,0,'');},beginSwipe:function(){this.startX=this.game.input.worldX;this.startY=this.game.input.worldY;this.game.input.onDown.removeAll();this.game.input.onUp.add(this.endSwipe.bind(this));},endSwipe:function(){this.endX=this.game.input.worldX;this.endY=this.game.input.worldY;var distX=this.startX-this.endX;var distY=this.startY-this.endY;if(Math.abs(distX)>Math.abs(distY)*2&&Math.abs(distX)>10){if(distX>0){this.nextClick();}
else{this.prevClick();}}
this.game.input.onDown.add(this.beginSwipe.bind(this));this.game.input.onUp.removeAll();},okClick:function(){if(!Utils.GlobalSettings.muted){this.clickSnd.play();}
this.okButton.events.onInputDown.removeAll();this.game.state.start(Utils.GlobalSettings.fromScreen);},prevClick:function(){if(!Utils.GlobalSettings.muted){this.flip2Snd.play();}
if(this.page>0){this.page--;this.updateItemButtons(0);}
this.prevButton.events.onInputDown.removeAll();this.prevButton.events.onInputDown.addOnce(this.prevClick.bind(this));},nextClick:function(){if(!Utils.GlobalSettings.muted){this.flip1Snd.play();}
if(this.page<Math.floor(this.maxItems/12)){this.page++;this.updateItemButtons(0);}
this.nextButton.events.onInputDown.removeAll();this.nextButton.events.onInputDown.addOnce(this.nextClick.bind(this));},kiteButtonClick:function(i){if(!Utils.GlobalSettings.muted){this.clickSnd.play();}
if(this.itemButtons&&this.itemButtons[i]){var tween;this.itemButtons[i].events.onInputDown.removeAll();this.itemButtons[i].events.onInputDown.addOnce(this.kiteButtonClick.bind(this,i));var startingNum=this.page*12;var item=startingNum+i;if(item<Utils.GlobalSettings.itemsAvailable.length){if(Utils.GlobalSettings.itemsAvailable[item]===-1){if(Utils.GlobalSettings.coins>=100){Utils.GlobalSettings.coins-=100;this.coinsText.setText(''+Utils.GlobalSettings.coins);Utils.GlobalSettings.itemsAvailable[item]=0;this.itemButtonCostTxts[i].setText('');this.itemButtonProp[i].visible=false;this.selectItem(i,item);}
else{this.statusMsgTxt.setText('Not enough coins!');this.statusMsgTxt.tint=0x111111;this.statusMsgTxt.updateTransform();this.statusMsgTxt.position.x=this.itemButtons[i].x-this.statusMsgTxt.textWidth/2;this.statusMsgTxt.position.y=this.itemButtons[i].y+70;this.statusMsgTxt.alpha=1;this.statusMsgTxt.visible=true;tween=this.game.add.tween(this.statusMsgTxt).to({alpha:0},1000,Phaser.Easing.Linear.Out);tween.start();}}
else{this.selectItem(i,item);}}
else{this.statusMsgTxt.setText('Not yet available!');this.statusMsgTxt.tint=0x111111;this.statusMsgTxt.updateTransform();this.statusMsgTxt.position.x=this.itemButtons[i].x-this.statusMsgTxt.textWidth/2;this.statusMsgTxt.position.y=this.itemButtons[i].y+70;this.statusMsgTxt.alpha=1;this.statusMsgTxt.visible=true;tween=this.game.add.tween(this.statusMsgTxt).to({alpha:0},1000,Phaser.Easing.Linear.Out);tween.start();}}},selectItem:function(i,item){Utils.GlobalSettings.itemSelected=item;Utils.GlobalSettings.save();this.statusMsgTxt.setText('item equipped!');this.statusMsgTxt.tint=0x111111;this.statusMsgTxt.updateTransform();this.statusMsgTxt.position.x=this.itemButtons[i].x-this.statusMsgTxt.textWidth/2;this.statusMsgTxt.position.y=this.itemButtons[i].y+70;this.statusMsgTxt.alpha=1;this.statusMsgTxt.visible=true;tween=this.game.add.tween(this.statusMsgTxt).to({alpha:0},1000,Phaser.Easing.Linear.Out);tween.start();this.equippedButton.visible=true;this.equippedButton.scale.set(0);this.equippedButton.setFrames(item,item,item,item);this.equippedButton.tint=this.itemButtons[i].tint;var tween2=this.game.add.tween(this.equippedButton.scale).to({x:1,y:1},1000,Phaser.Easing.Elastic.Out);tween2.start();this.equippedTxt.visible=true;this.equippedItemTxt.visible=true;},updateItemButtons:function(delay){if(this.itemButtons&&this.itemButtonCostTxts&&this.itemButtonProp){var spr;var costTxt;var yp=300;var xp=0;var itembuttontween;var costtxttween;var proptween;var prop;var itemIndex=0;var startingNum=this.page*12;for(var i=0;i<this.itemButtons.length;i++){spr=this.itemButtons[i];costTxt=this.itemButtonCostTxts[i];prop=this.itemButtonProp[i];if(spr&&costTxt&&prop){spr.scale.set(0);spr.setFrames(0,0,0,0);costTxt.tint=0x555555;costTxt.alpha=0;costTxt.visible=true;prop.alpha=0;prop.visible=true;if((startingNum+i)<Utils.GlobalSettings.itemsAvailable.length){if(Utils.GlobalSettings.itemsAvailable[(startingNum+i)]===-1){prop.frame=1;}
else{prop.visible=false;costTxt.visible=false;}}
else{prop.frame=1;}
itemIndex=startingNum+i+1;if(itemIndex>this.maxItems){spr.setFrames(0,0,0,0);costTxt.setText('');spr.alpha=0.2;}
else{spr.setFrames(itemIndex-1,itemIndex-1,itemIndex-1,itemIndex-1);costTxt.setText('100 Coins');spr.alpha=1;}
costTxt.updateTransform();costTxt.position.x=110+(xp*140)-costTxt.textWidth/2;xp++;if(i===3||i==7){yp+=200;xp=0;}
itembuttontween=this.game.add.tween(spr.scale).to({x:1.4,y:1.4},1000,Phaser.Easing.Elastic.Out,false,delay+(i*25));itembuttontween.start();costtxttween=this.game.add.tween(costTxt).to({alpha:1},1000,Phaser.Easing.Linear.Out,false,delay+(i*50));costtxttween.start();proptween=this.game.add.tween(prop).to({alpha:1},1000,Phaser.Easing.Linear.Out,false,delay+(i*50));proptween.start();}}}},exitClick:function(){if(!Utils.GlobalSettings.muted){this.clickSnd.play();}
this.exitButton.events.onInputDown.removeAll();this.exitButton.visible=false;this.game.state.start('mainmenu');return false;},soundClick:function(){Utils.GlobalSettings.muted=!Utils.GlobalSettings.muted;if(!Utils.GlobalSettings.muted){this.clickSnd.play();this.soundButton.setFrames(7,6,7);}
else{this.soundButton.setFrames(9,8,9);}
this.soundButton.events.onInputDown.removeAll();this.soundButton.events.onInputDown.addOnce(this.soundClick.bind(this));},update:function(){},shutdown:function(){if(navigator.isCocoonJS){document.removeEventListener("backbutton",this.exitHandler,false);}
Utils.GlobalSettings.save();if(this.clickSnd){this.clickSnd.stop();this.clickSnd.destroy();this.clickSnd=null;}
if(this.flip1Snd){this.flip1Snd.stop();this.flip1Snd.destroy();this.flip1Snd=null;}
if(this.flip2Snd){this.flip2Snd.stop();this.flip2Snd.destroy();this.flip2Snd=null;}
if(this.soundButton){this.soundButton.destroy();this.soundButton=null;}
if(this.bg){this.bg.destroy();this.bg=null;}
if(this.levelselectbg){this.levelselectbg.destroy();this.levelselectbg=null;}
if(this.prevButton){this.prevButton.destroy();this.prevButton=null;}
if(this.nextButton){this.nextButton.destroy();this.nextButton=null;}
var i=0;if(this.itemButtons){for(i=0;i<this.itemButtons.length;i++){if(this.itemButtons[i]){this.itemButtons[i].destroy();this.itemButtons[i]=null;}}
this.itemButtons=null;}
if(this.itemButtonCostTxts){for(i=0;i<this.itemButtonCostTxts.length;i++){if(this.itemButtonCostTxts[i]){this.itemButtonCostTxts[i].destroy();this.itemButtonCostTxts[i]=null;}}
this.itemButtonCostTxts=null;}
if(this.itemButtonProp){for(i=0;i<this.itemButtonProp.length;i++){if(this.itemButtonProp[i]){this.itemButtonProp[i].destroy();this.itemButtonProp[i]=null;}}
this.itemButtonProp=null;}
if(this.exitButton){this.exitButton.destroy();this.exitButton=null;}
if(this.statusMsgTxt){this.statusMsgTxt.destroy();this.statusMsgTxt=null;}
if(this.okButton){this.okButton.destroy();this.okButton=null;}
if(this.equippedButton){this.equippedButton.destroy();this.equippedButton=null;}
if(this.equippedTxt){this.equippedTxt.destroy();this.equippedTxt=null;}
if(this.equippedItemTxt){this.equippedItemTxt.destroy();this.equippedItemTxt=null;}
if(this.coinsText){this.coinsText.destroy();this.coinsText=null;}
Utils.GlobalSettings.fromScreen='kiteselect';console.log('destroy kiteequip');}};﻿Screen.IntroScreen=function(game){this.game=game;};Screen.IntroScreen.prototype={create:function(){this.setup();},setup:function(){this.game.stage.backgroundColor=0xffffff;this.comic1=this.game.add.image(-500,10,'comic1');this.comic2=this.game.add.image(Utils.GlobalSettings.width+500,10,'comic2');this.comic3=this.game.add.image(10,Utils.GlobalSettings.height+500,'comic3');this.comic4=this.game.add.image(-500,530,'comic4');this.comic5=this.game.add.image(Utils.GlobalSettings.width+500,530,'comic5');this.comic6=this.game.add.image(10,Utils.GlobalSettings.height+500,'comic6');var tween1=this.game.add.tween(this.comic1).to({x:10},1000,Phaser.Easing.Sinusoidal.Out,true,1000);var tween2=this.game.add.tween(this.comic2).to({x:Utils.GlobalSettings.width-208},1000,Phaser.Easing.Sinusoidal.Out,true,3000);var tween3=this.game.add.tween(this.comic3).to({y:270},1000,Phaser.Easing.Sinusoidal.Out,true,5000);var tween4=this.game.add.tween(this.comic4).to({x:10},1000,Phaser.Easing.Sinusoidal.Out,true,7000);var tween5=this.game.add.tween(this.comic5).to({x:Utils.GlobalSettings.width-208},1000,Phaser.Easing.Sinusoidal.Out,true,9000);var tween6=this.game.add.tween(this.comic6).to({y:790},1000,Phaser.Easing.Sinusoidal.Out,true,11000);this.startTimer=false;this.timer=0;tween6.onComplete.addOnce(this.stripDone,this);this.game.add.sprite(0,0,'');this.game.input.onDown.addOnce(this.next,this);},stripDone:function(){this.startTimer=true;this.timer=0;},next:function(){this.game.state.start('gamescreen',Phaser.Plugin.StateTransition.Out.SlideTop,Phaser.Plugin.StateTransition.In.SlideTop);},update:function(){if(this.startTimer){this.timer++;if(this.timer>1000){this.timer=0;this.startTimer=false;this.next();}}},shutdown:function(){if(this.comic1){this.comic1.destroy();this.comic1=null;}
if(this.comic2){this.comic2.destroy();this.comic2=null;}
if(this.comic3){this.comic3.destroy();this.comic3=null;}
if(this.comic4){this.comic4.destroy();this.comic4=null;}
if(this.comic5){this.comic5.destroy();this.comic5=null;}
if(this.comic6){this.comic6.destroy();this.comic6=null;}
Utils.GlobalSettings.fromScreen='introscreen';console.log('destroy introscreen');}};﻿Screen.GameScreen=function(game){this.game=game;};Screen.GameScreen.prototype={create:function(){Utils.GlobalSettings.save();this.screenShake=this.game.plugins.add(Phaser.Plugin.ScreenShake);this.setup();this.game.add.sprite(0,0,'');},setup:function(){this.clickSnd=this.game.add.audio('click');this.explosionSnd=this.game.add.audio('explosion');this.lifeSnd=this.game.add.audio('life');this.invincibleSnd=this.game.add.audio('invincible');this.invincibleDoneSnd=this.game.add.audio('wrong');this.deadSnd=this.game.add.audio('dead');this.eatSnd=this.game.add.audio('drip');this.bg=this.game.add.image(0,0,'bg');this.MAX_MISSILES=20;this.MAX_CANDY=10;this.MAX_LEVEL_CANDY=1;this.MAX_LEVEL_MISSILES=2;this.scoreText=this.game.add.bitmapText(20,10,'fader','0',72);this.score=0;this.scoreBuffer=0;this.actualScore=0;this.lifeSprite=this.game.add.sprite(20,80,'player');this.lifeSprite.scale.set(0.5);this.life=3;this.lifeText=this.game.add.bitmapText(70,85,'arial','x'+this.life,30);this.invincible=false;this.invincibilityTimer=0;this.gameOver=false;this.pause=false;this.pauseTimer=0;this.slomo=false;this.slomoTimer=0;this.ghost=false;this.ghostTimer=0;this.candyGroup=this.game.add.group();var i=0;for(i=0;i<this.MAX_CANDY;i++){var candy=this.candyGroup.add(new Entity.Candy(this.game,this));candy.kill();}
this.missileGroup=this.game.add.group();for(i=0;i<this.MAX_MISSILES;i++){var missile=this.missileGroup.add(new Entity.Missile(this.game));missile.setStage(this);missile.kill();}
this.player=this.game.add.sprite(0,0,'player');this.player.anchor.setTo(0.5,0.5);this.player.animations.add('idle',[0,1],10,true);this.player.animations.play('idle');this.explosionGroup=this.game.add.group();for(i=0;i<this.MAX_MISSILES;i++){var explosion=this.game.add.sprite(0,0,'explosion');explosion.anchor.setTo(0.5,0.5);var animation=explosion.animations.add('boom',[0,1,2,3],60,false);animation.killOnComplete=true;this.explosionGroup.add(explosion);explosion.kill();}
this.collectGroup=this.game.add.group();for(i=0;i<this.MAX_CANDY;i++){var collect=this.game.add.sprite(0,0,'collect');collect.anchor.setTo(0.5,0.5);var animation=collect.animations.add('boom',[0,1,2,3,4],30,false);animation.killOnComplete=true;this.collectGroup.add(collect);collect.kill();}
this.gameoverImg=this.game.add.image(Utils.GlobalSettings.width/2,Utils.GlobalSettings.height/2,'gameover');this.gameoverImg.anchor.set(0.5,0.5);this.gameoverImg.visible=false;this.invincibleImg=this.game.add.image(Utils.GlobalSettings.width/2,Utils.GlobalSettings.height/2,'invincibleimg');this.invincibleImg.anchor.set(0.5,0.5);this.invincibleImg.visible=false;this.lifeupImg=this.game.add.image(Utils.GlobalSettings.width/2,Utils.GlobalSettings.height/2,'lifeupimg');this.lifeupImg.anchor.set(0.5,0.5);this.lifeupImg.visible=false;this.slomoImg=this.game.add.image(Utils.GlobalSettings.width/2,Utils.GlobalSettings.height/2,'slomoimg');this.slomoImg.anchor.set(0.5,0.5);this.slomoImg.visible=false;this.ghostImg=this.game.add.image(Utils.GlobalSettings.width/2,Utils.GlobalSettings.height/2,'ghostimg');this.ghostImg.anchor.set(0.5,0.5);this.ghostImg.visible=false;this.restartButton=this.game.add.button(Utils.GlobalSettings.width/2,Utils.GlobalSettings.height/2+100,'restart',null,this,1,0,1);this.restartButton.anchor.setTo(0.5);this.restartButton.visible=false;this.restartButton.events.onInputDown.addOnce(this.restartClick.bind(this));this.game.input.activePointer.x=Utils.GlobalSettings.width/2;this.game.input.activePointer.y=Utils.GlobalSettings.height/2-100;this.player.x=this.game.input.activePointer.x;this.player.y=this.game.input.activePointer.y;this.getCandy();this.soundButton=null;if(!Utils.GlobalSettings.muted){this.soundButton=this.game.add.button(Utils.GlobalSettings.width-120,5,'systembuttons',null,this,7,6,7);}
else{this.soundButton=this.game.add.button(Utils.GlobalSettings.width-120,5,'systembuttons',null,this,9,8,9);}
this.soundButton.width=50;this.soundButton.height=50;this.soundButton.events.onInputDown.addOnce(this.soundClick.bind(this));this.stopMusicOnLoad=false;this.exitButton=this.game.add.button(Utils.GlobalSettings.width-60,5,'systembuttons',null,this,5,4,5);this.exitButton.width=50;this.exitButton.height=50;this.exitButton.events.onInputDown.addOnce(this.exitClick.bind(this));this.pauseButton=this.game.add.button(Utils.GlobalSettings.width-180,5,'systembuttons',null,this,1,0,1);this.pauseButton.width=50;this.pauseButton.height=50;this.pauseButton.events.onInputDown.addOnce(this.pauseClick.bind(this));this.pauseKey=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);this.pauseKey.onDown.addOnce(this.pauseClick.bind(this),this);this.game.input.onDown.addOnce(this.unpause,this);this.pauseText=this.game.add.bitmapText(0,Utils.GlobalSettings.height/2-50,'mecha',"             - game paused -\nTap or Spacebar to unpause",20);this.pauseText.updateTransform();this.pauseText.position.x=Utils.GlobalSettings.width/2-this.pauseText.textWidth/2;this.pauseText.visible=false;if(!Utils.GlobalSettings.isMobile){this.game.canvas.oncontextmenu=function(e){e.preventDefault();};}
if(navigator.isCocoonJS){this.exitHandler=this.exitClick.bind(this);document.addEventListener("backbutton",this.exitHandler,false);}
this.firstTime=Utils.GlobalSettings.firstTime;if(this.firstTime){this.tutorialText=this.game.add.bitmapText(0,Utils.GlobalSettings.height/2-300,'mecha',"",20);Utils.GlobalSettings.firstTime=false;Utils.GlobalSettings.save();this.tutorialText.setText("Collect candy. Avoid Missiles. Survive!");this.tutorialText.updateTransform();this.tutorialText.position.x=Utils.GlobalSettings.width/2-this.tutorialText.textWidth/2;this.tutorialText.alpha=0;var tween=this.game.add.tween(this.tutorialText).to({alpha:1,y:Utils.GlobalSettings.height/2-200},5000,Phaser.Easing.Linear.Out).to({alpha:0},5000,Phaser.Easing.Linear.Out);tween.start();}
this.game.input.keyboard.addKeyCapture([Phaser.Keyboard.LEFT,Phaser.Keyboard.RIGHT,Phaser.Keyboard.UP,Phaser.Keyboard.DOWN,Phaser.Keyboard.SPACEBAR]);},unpause:function(){if(this.game.paused){this.game.paused=false;this.pauseText.visible=false;this.pauseButton.setFrames(0,0,0);}
this.game.input.onDown.removeAll();this.game.input.onDown.addOnce(this.unpause,this);},increaseScore:function(){this.score+=10;if(this.score>this.actualScore){this.score=this.actualScore;}
this.scoreText.setText(''+this.score);},launchMissile:function(x,y){var missile=this.missileGroup.getFirstDead();if(missile){missile.SPEED=this.game.rnd.integerInRange(100,500);missile.TURN_RATE=missile.SPEED/50;missile.revive();missile.x=x;missile.y=y;}
return missile;},getCandy:function(){var candy=this.candyGroup.getFirstDead();if(candy){candy.revive();candy.x=this.game.rnd.integerInRange(64,Utils.GlobalSettings.width-128);candy.y=this.game.rnd.integerInRange(64,Utils.GlobalSettings.height-128);candy.setup();}
return candy;},getExplosion:function(x,y){var explosion=this.explosionGroup.getFirstDead();if(explosion){explosion.revive();explosion.x=x;explosion.y=y;explosion.angle=this.game.rnd.integerInRange(0,360);explosion.tint=0xff0000;explosion.animations.play('boom');if(!Utils.GlobalSettings.muted){this.explosionSnd.play();}}
return explosion;},doGameOver:function(){this.gameOver=true;Utils.GlobalSettings.timesPlayed++;this.missileGroup.forEachAlive(function(m){m.kill();this.getExplosion(m.x,m.y);},this);this.candyGroup.forEachAlive(function(c){c.collect();this.getCollect(c.x,c.y);},this);this.player.animations.stop();if(this.screenShake){this.screenShake.shake(30);}
var tween2=this.game.add.tween(this.player).to({y:Utils.GlobalSettings.height+500,rotation:Math.PI*10},3000,Phaser.Easing.Sinusoidal.Out,true);this.gameoverImg.visible=true;this.gameoverImg.alpha=0;var tween1=this.game.add.tween(this.gameoverImg).to({alpha:1},1000,Phaser.Easing.Linear.Out,true);this.restartButton.visible=true;this.restartButton.scale.setTo(0);var restartTween=this.game.add.tween(this.restartButton.scale).to({x:1,y:1},1000,Phaser.Easing.Back.Out,true,1000);var restartSpinTween=this.game.add.tween(this.restartButton).to({angle:360},5000,Phaser.Easing.Linear.Out,true);restartSpinTween.loop();if(!Utils.GlobalSettings.muted){this.deadSnd.play();}
this.submitScore();},restartClick:function(){this.restartButton.events.onInputDown.removeAll();this.restartButton.events.onInputDown.addOnce(this.restartClick.bind(this));this.game.state.start('gamescreen');},getCollect:function(x,y){var collect=this.collectGroup.getFirstDead();if(collect){collect.revive();collect.x=x;collect.y=y;collect.angle=this.game.rnd.integerInRange(0,360);collect.animations.play('boom');if(!Utils.GlobalSettings.muted){this.eatSnd.play();}}
return collect;},submitScore:function(){var xmlHttp=new XMLHttpRequest();xmlHttp.open("POST","http://www.gamepyong.com/firewords/php/firewords.php",true);var parameters="action=score&nickname="+Utils.GlobalSettings.lastNickname+"&score="+this.actualScore;xmlHttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");xmlHttp.onreadystatechange=function(){if(xmlHttp.readyState==4&&xmlHttp.status==200){var msg=xmlHttp.responseText;console.log('score submit');}}.bind(this);xmlHttp.ontimeout=function(){}.bind(this);xmlHttp.send(parameters);},exitClick:function(){if(!Utils.GlobalSettings.muted){this.clickSnd.play();}
this.exitButton.events.onInputDown.removeAll();this.soundButton.events.onInputDown.removeAll();this.pauseButton.events.onInputDown.removeAll();this.exitButton.visible=false;this.soundButton.visible=false;this.game.state.start('mainmenu',Phaser.Plugin.StateTransition.Out.SlideRight,Phaser.Plugin.StateTransition.In.SlideRight);return false;},soundClick:function(){Utils.GlobalSettings.muted=!Utils.GlobalSettings.muted;if(!Utils.GlobalSettings.muted){this.clickSnd.play();this.soundButton.setFrames(7,6,7);Utils.BackgroundMusic.bgm1.restart('',0,0.3,true);}
else{this.soundButton.setFrames(9,8,9);Utils.BackgroundMusic.bgm1.pause();}
this.soundButton.events.onInputDown.removeAll();this.soundButton.events.onInputDown.addOnce(this.soundClick.bind(this));},pauseClick:function(){if(!Utils.GlobalSettings.muted){this.clickSnd.play();}
this.pauseGame();this.pauseKey.onDown.removeAll();this.pauseKey.onDown.addOnce(this.pauseClick.bind(this),this);this.pauseButton.events.onInputDown.removeAll();this.pauseButton.events.onInputDown.addOnce(this.pauseClick.bind(this));},pauseGame:function(){if(!this.game.paused){this.game.paused=true;this.pauseText.visible=true;this.pauseButton.setFrames(1,1,1);}
else{this.unpause();}},handleLevel:function(){if(this.actualScore<2000){this.MAX_LEVEL_CANDY=2;this.MAX_LEVEL_MISSILES=2;}
else
if(this.actualScore<5000){this.MAX_LEVEL_CANDY=3;this.MAX_LEVEL_MISSILES=2;}
else
if(this.actualScore<8000){this.MAX_LEVEL_CANDY=3;this.MAX_LEVEL_MISSILES=3;}
else
if(this.actualScore<10000){this.MAX_LEVEL_CANDY=4;this.MAX_LEVEL_MISSILES=3;}
else
if(this.actualScore<13000){this.MAX_LEVEL_CANDY=4;this.MAX_LEVEL_MISSILES=4;}
else
if(this.actualScore<16000){this.MAX_LEVEL_CANDY=5;this.MAX_LEVEL_MISSILES=4;}
else
if(this.actualScore<20000){this.MAX_LEVEL_CANDY=5;this.MAX_LEVEL_MISSILES=5;}
else
if(this.actualScore<24000){this.MAX_LEVEL_CANDY=5;this.MAX_LEVEL_MISSILES=6;}
else
if(this.actualScore<26000){this.MAX_LEVEL_CANDY=6;this.MAX_LEVEL_MISSILES=6;}
else
if(this.actualScore<30000){this.MAX_LEVEL_CANDY=7;this.MAX_LEVEL_MISSILES=7;}
else
if(this.actualScore<35000){this.MAX_LEVEL_CANDY=7;this.MAX_LEVEL_MISSILES=8;}
else
if(this.actualScore<40000){this.MAX_LEVEL_CANDY=8;this.MAX_LEVEL_MISSILES=9;}
else
if(this.actualScore<45000){this.MAX_LEVEL_CANDY=9;this.MAX_LEVEL_MISSILES=10;}
else
if(this.actualScore<50000){this.MAX_LEVEL_CANDY=10;this.MAX_LEVEL_MISSILES=11;}
else
if(this.actualScore<55000){this.MAX_LEVEL_CANDY=10;this.MAX_LEVEL_MISSILES=12;}
else
if(this.actualScore<60000){this.MAX_LEVEL_CANDY=10;this.MAX_LEVEL_MISSILES=13;}
else
if(this.actualScore<65000){this.MAX_LEVEL_CANDY=10;this.MAX_LEVEL_MISSILES=14;}
else
if(this.actualScore<70000){this.MAX_LEVEL_CANDY=10;this.MAX_LEVEL_MISSILES=15;}
else
if(this.actualScore<75000){this.MAX_LEVEL_CANDY=10;this.MAX_LEVEL_MISSILES=16;}
else
if(this.actualScore<80000){this.MAX_LEVEL_CANDY=10;this.MAX_LEVEL_MISSILES=17;}
else
if(this.actualScore<85000){this.MAX_LEVEL_CANDY=10;this.MAX_LEVEL_MISSILES=18;}
else
if(this.actualScore<90000){this.MAX_LEVEL_CANDY=10;this.MAX_LEVEL_MISSILES=19;}
else{this.MAX_LEVEL_CANDY=10;this.MAX_LEVEL_MISSILES=20;}},update:function(){if(this.gameOver){return;}
if(this.missileGroup.countLiving()<this.MAX_LEVEL_MISSILES){this.launchMissile(this.game.rnd.integerInRange(50,Utils.GlobalSettings.width-50),Utils.GlobalSettings.height+50);}
if(this.candyGroup.countLiving()<this.MAX_LEVEL_CANDY){this.getCandy();}
this.missileGroup.forEachAlive(function(m){if(!this.ghost){var distance=this.game.math.distance(m.x,m.y,this.game.input.activePointer.x,this.game.input.activePointer.y);if(distance<50){m.kill();if(this.screenShake){this.screenShake.shake(10);}
this.getExplosion(m.x,m.y);if(!this.invincible){this.life--;this.lifeText.setText('x'+this.life);if(this.life<=0){this.doGameOver();}}
else{this.actualScore+=200;this.scoreBuffer=this.actualScore;this.handleLevel();}}}},this);this.candyGroup.forEachAlive(function(c){var distance=this.game.math.distance(c.x,c.y,this.game.input.activePointer.x,this.game.input.activePointer.y);if(distance<50){if(c.frame===76){this.ghost=true;this.ghostTimer=0;if(!Utils.GlobalSettings.muted){this.lifeSnd.play();}
this.ghostImg.visible=true;this.ghostImg.alpha=1;this.ghostImg.scale.set(0);var tween0=this.game.add.tween(this.ghostImg.scale).to({x:3,y:3},3000,Phaser.Easing.Linear.Out,true);var tween1=this.game.add.tween(this.ghostImg).to({alpha:0},1500,Phaser.Easing.Linear.Out,true);this.pause=true;this.pauseTimer=0;}
else
if(c.frame===77){if(!this.slomo){this.missileGroup.forEachAlive(function(m){m.doSloMo();},this);}
this.slomo=true;this.slomoTimer=0;if(!Utils.GlobalSettings.muted){this.lifeSnd.play();}
this.slomoImg.visible=true;this.slomoImg.alpha=1;this.slomoImg.scale.set(0);var tween0=this.game.add.tween(this.slomoImg.scale).to({x:3,y:3},3000,Phaser.Easing.Linear.Out,true);var tween1=this.game.add.tween(this.slomoImg).to({alpha:0},1500,Phaser.Easing.Linear.Out,true);this.pause=true;this.pauseTimer=0;}
else
if(c.frame===78){this.invincible=true;this.invincibilityTimer=0;if(!Utils.GlobalSettings.muted){this.invincibleSnd.play();}
this.invincibleImg.visible=true;this.invincibleImg.alpha=1;this.invincibleImg.scale.set(0);var tween0=this.game.add.tween(this.invincibleImg.scale).to({x:3,y:3},3000,Phaser.Easing.Linear.Out,true);var tween1=this.game.add.tween(this.invincibleImg).to({alpha:0},1500,Phaser.Easing.Linear.Out,true);this.pause=true;this.pauseTimer=0;}
else
if(c.frame===79){this.life++;this.lifeText.setText('x'+this.life);if(!Utils.GlobalSettings.muted){this.lifeSnd.play();}
this.lifeupImg.visible=true;this.lifeupImg.alpha=1;this.lifeupImg.scale.set(0);var tween0=this.game.add.tween(this.lifeupImg.scale).to({x:3,y:3},3000,Phaser.Easing.Linear.Out,true);var tween1=this.game.add.tween(this.lifeupImg).to({alpha:0},1500,Phaser.Easing.Linear.Out,true);this.pause=true;this.pauseTimer=0;}
c.collect();this.getCollect(c.x,c.y);this.actualScore+=100;this.scoreBuffer=this.actualScore;this.handleLevel();}},this);var prevX=this.player.x;this.player.x=this.game.input.activePointer.x;this.player.y=this.game.input.activePointer.y;if(this.player.x>prevX){this.player.scale.x=-1;}
if(this.player.x<prevX){this.player.scale.x=1;}
else{this.player.scale.x=this.player.scale.x;}
if(this.scoreBuffer>0){this.increaseScore();this.scoreBuffer-=10;if(this.scoreBuffer<0){this.scoreBuffer=0;}}
if(this.invincible){this.player.tint=0xff0000;this.lifeSprite.tint=0xff0000;this.invincibilityTimer++;if(this.invincibilityTimer%10===0){this.player.tint=0x00ff00;this.lifeSprite.tint=0x00ff00;}
if(this.invincibilityTimer>450&&this.invincibilityTimer%5===0){this.player.tint=0xffffff;this.lifeSprite.tint=0xffffff;}
if(this.invincibilityTimer>500){this.invincibilityTimer=0;this.invincible=false;this.player.tint=0xffffff;this.lifeSprite.tint=0xffffff;if(!Utils.GlobalSettings.muted){this.invincibleDoneSnd.play();}}}
if(this.slomo){this.slomoTimer++;if(this.slomoTimer>500){this.slomoTimer=0;this.slomo=false;if(!Utils.GlobalSettings.muted){this.invincibleDoneSnd.play();}
this.missileGroup.forEachAlive(function(m){m.endSloMo();},this);}}
if(this.ghost){this.player.tint=0x0000ff;this.lifeSprite.tint=0x0000ff;this.ghostTimer++;if(this.ghostTimer%10===0){this.player.tint=0xff00ff;this.lifeSprite.tint=0xff00ff;}
if(this.ghostTimer>450&&this.ghostTimer%5===0){this.player.tint=0xffffff;this.lifeSprite.tint=0xffffff;}
if(this.ghostTimer>500){this.ghostTimer=0;this.ghost=false;this.player.tint=0xffffff;this.lifeSprite.tint=0xffffff;if(!Utils.GlobalSettings.muted){this.invincibleDoneSnd.play();}}}
if(this.pause){this.pauseTimer++;if(this.pauseTimer>100){this.pause=false;this.pauseTimer=0;}}},shutdown:function(){Utils.GlobalSettings.save();if(navigator.isCocoonJS){document.removeEventListener("backbutton",this.exitHandler,false);if(Utils.adManager.banner){Utils.adManager.banner.hide();}}
if(this.clickSnd){this.clickSnd.stop();this.clickSnd.destroy();this.clickSnd=null;}
if(this.soundButton){this.soundButton.destroy();this.soundButton=null;}
if(this.exitButton){this.exitButton.destroy();this.exitButton=null;}
if(this.screenShake){this.screenShake.destroy();this.screenShake=null;}
if(this.explosionSnd){this.explosionSnd.stop();this.explosionSnd.destroy();this.explosionSnd=null;}
if(this.invincibleDoneSnd){this.invincibleDoneSnd.stop();this.invincibleDoneSnd.destroy();this.invincibleDoneSnd=null;}
if(this.lifeSnd){this.lifeSnd.stop();this.lifeSnd.destroy();this.lifeSnd=null;}
if(this.invincibleSnd){this.invincibleSnd.stop();this.invincibleSnd.destroy();this.invincibleSnd=null;}
if(this.deadSnd){this.deadSnd.stop();this.deadSnd.destroy();this.deadSnd=null;}
if(this.eatSnd){this.eatSnd.stop();this.eatSnd.destroy();this.eatSnd=null;}
if(this.bg){this.bg.destroy();this.bg=null;}
if(this.scoreText){this.scoreText.destroy();this.scoreText=null;}
if(this.lifeSprite){this.lifeSprite.destroy();this.lifeSprite=null;}
if(this.lifeText){this.lifeText.destroy();this.lifeText=null;}
if(this.candyGroup){this.candyGroup.destroy();this.candyGroup=null;}
if(this.missileGroup){this.missileGroup.destroy();this.missileGroup=null;}
if(this.player){this.player.destroy();this.player=null;}
if(this.explosionGroup){this.explosionGroup.destroy();this.explosionGroup=null;}
if(this.collectGroup){this.collectGroup.destroy();this.collectGroup=null;}
if(this.gameoverImg){this.gameoverImg.destroy();this.gameoverImg=null;}
if(this.invincibleImg){this.invincibleImg.destroy();this.invincibleImg=null;}
if(this.lifeupImg){this.lifeupImg.destroy();this.lifeupImg=null;}
if(this.slomoImg){this.slomoImg.destroy();this.slomoImg=null;}
if(this.ghostImg){this.ghostImg.destroy();this.ghostImg=null;}
if(this.restartButton){this.restartButton.destroy();this.restartButton=null;}
if(this.tutorialText){this.tutorialText.destroy();this.tutorialText=null;}
if(this.pauseButton){this.pauseButton.destroy();this.pauseButton=null;}
this.pauseKey=null;if(this.pauseText){this.pauseText.destroy();this.pauseText=null;}
Utils.GlobalSettings.fromScreen='gamescreen';console.log('destroy gamescreen');}};